
<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8" />
    <title>Havsnavigering</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        html, body, #map {
            height: 100%;
            margin: 0;
            padding: 0;
            background: #000020;
        }
        #infoBox {
            position: absolute;
            top: 80px;
            left: 10px;
            background: rgba(0, 0, 30, 0.8);
            color: #00ffff;
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 1.1em;
            box-shadow: 0 0 10px #00ffff55;
            z-index: 1000;
        }
        #searchBox {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            background: rgba(0,0,0,0.5);
            padding: 5px;
            border-radius: 10px;
        }
        #searchInput {
            padding: 5px;
            font-size: 1em;
            width: 200px;
            border: none;
            border-radius: 5px;
        }
        #searchButton {
            padding: 5px 10px;
            margin-left: 5px;
            background: #00ffff;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #compassContainer {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 80px;
            height: 80px;
            z-index: 1000;
        }
        #compassCanvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="searchBox">
        <input type="text" id="searchInput" placeholder="Sök plats" />
        <button id="searchButton">Sök</button>
    </div>
    <div id="infoBox">
        <div id="distance">Avstånd: –</div>
        <div id="bearing">Riktning: –</div>
    </div>
    <div id="compassContainer"><canvas id="compassCanvas"></canvas></div>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([57.7089, 11.9746], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        const positionMarker = L.marker([57.7089, 11.9746]).addTo(map).bindPopup("Din position").openPopup();
        let destinationMarker, line;

        function updateCompass(angle) {
            const canvas = document.getElementById('compassCanvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width = canvas.offsetWidth;
            const h = canvas.height = canvas.offsetHeight;
            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            ctx.arc(w/2, h/2, w/2 - 2, 0, 2 * Math.PI);
            ctx.strokeStyle = "#00ffff";
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = "red";
            ctx.moveTo(w/2, h/2);
            const len = w/2 - 10;
            const rad = (angle - 90) * Math.PI / 180;
            ctx.lineTo(w/2 + len * Math.cos(rad), h/2 + len * Math.sin(rad));
            ctx.fill();
            ctx.fillStyle = "#00ffff";
            ctx.font = "10px Arial";
            ctx.fillText("N", w/2 - 3, 10);
            ctx.fillText("S", w/2 - 3, h - 5);
            ctx.fillText("E", w - 10, h/2 + 3);
            ctx.fillText("W", 2, h/2 + 3);
        }
        updateCompass(0);

        document.getElementById('searchButton').addEventListener('click', () => {
            const query = document.getElementById('searchInput').value;
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        const result = data[0];
                        const lat = parseFloat(result.lat);
                        const lon = parseFloat(result.lon);
                        if (destinationMarker) map.removeLayer(destinationMarker);
                        if (line) map.removeLayer(line);
                        destinationMarker = L.marker([lat, lon]).addTo(map).bindPopup("Mål").openPopup();
                        line = L.polyline([positionMarker.getLatLng(), [lat, lon]], {color: 'cyan'}).addTo(map);
                        map.fitBounds(line.getBounds());

                        const dist = map.distance(positionMarker.getLatLng(), [lat, lon]) / 1852;
                        const angle = (Math.atan2(lon - positionMarker.getLatLng().lng, lat - positionMarker.getLatLng().lat) * 180 / Math.PI + 360) % 360;
                        document.getElementById("distance").textContent = `Avstånd: ${dist.toFixed(2)} NM`;
                        document.getElementById("bearing").textContent = `Riktning: ${angle.toFixed(0)}°`;
                        updateCompass(angle);
                    } else {
                        alert("Sökningen misslyckades.");
                    }
                })
                .catch(err => {
                    alert("Fel vid sökning.");
                    console.error(err);
                });
        });
    </script>
</body>
</html>
